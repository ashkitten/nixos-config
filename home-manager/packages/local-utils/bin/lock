#! /usr/bin/env zsh
# physlock is enabled by configuration.nix

# Check if screen is already locked, or set a flag that it is locked
[[ -e "/tmp/lock_$USER" ]] && return || touch "/tmp/lock_$USER"

function revert {
    # Reenable console switching
    physlock -L

    # Remove screen lock flag
    rm "/tmp/lock_$USER"

    # Switch workspace back
    i3-msg "workspace back_and_forth"

    # Reenable mouse
    xinput enable "pointer:ROCCAT ROCCAT Tyon Black Mouse"

    # Unpause notifications
    pkill -SIGUSR2 dunst

    # Disable dpms again
    xset -dpms
}
trap revert SIGHUP SIGINT SIGTERM

# Lock console switching
physlock -l

# Switch to a different workspace (fuck discord)
i3-msg "workspace locked"

# Disable mouse so it doesn't wake up the computer all the time
xinput disable "pointer:ROCCAT ROCCAT Tyon Black Mouse"

# Pause notifications while locked
pkill -SIGUSR1 dunst

XSECURELOCK_SAVER=saver_xscreensaver xsecurelock
revert
